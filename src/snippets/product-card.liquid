{% assign is_on_sale = false %}
{% assign is_top_seller = false %}
{% assign notice_text = "On Sale" %}

{% for collection in product.collections %}
  {% if collection.title == 'Top Sellers' %}
    {% assign is_top_seller = true %}
    {% assign notice_text = "Top Seller" %}
  {% endif %}
{% endfor %}

{% if product.price < product.compare_at_price %}
  {% assign is_on_sale = true %}
  {% assign notice_text = "On Sale" %}
{% endif %}

{% if is_on_sale and is_top_seller %}
  {% assign is_top_seller = false %}
{% endif %}

<article class="product-card flexgrid__item one-whole one-third--medium-up{% if is_on_sale %} is-on-sale{% endif %}{% if is_top_seller %} is-top-seller{% endif %}">
  <div class="product-card__image">
    <div class="image-wrapper" style="padding-bottom: {{ 1 | divided_by: product.featured_image.aspect_ratio | times: 100 }}%">
      <a href="{{ product.url | within: collection }}">
        <img class="is-lazyloaded lazyload" data-sizes="auto" data-srcset="{% include 'srcset', image: product.featured_image | img_url %}" src="{{ product.featured_image | img_url }}" alt="">
      </a>
    </div>
    {% comment %} /.image-wrapper {% endcomment %}
  </div>
  {% comment %} /__image {% endcomment %}
  <div class="product-card__info">
    <header>
      <h3 class="product-card__title"><a href="{{ product.url | within: collection }}">{{ product.title }}</a></h3>
    </header>
    <p class="product-card__vendor">{{ product.vendor | link_to_vendor }}</p>
    <p class="product-card__price">{{ product.price_max | money }}{% if product.price < product.compare_at_price_max %}<span class="product-card__compare-price"><s>{{ product.compare_at_price }}</s></span>{% endif %}</p>
    {% if is_on_sale or is_top_seller %}
      <span class="product-card__notice{% if is_on_sale %} is-sale{% endif %}{% if is_top_seller %} is-top-seller{% endif %}">{{ notice_text }}</span>
    {% endif %}
  </div>
  {% comment %} /__info {% endcomment %}
  <div class="product-card__cta">
    <a href="{{ product.url | within: collection }}" class="button button--primary button--small">Buy Now</a>
  </div>
  {% comment %} /__cta {% endcomment %}
</article>